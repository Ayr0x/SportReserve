{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>CPanel - SportReserve</title>
    <link rel="icon" type="image/png" href="{% static 'img/logo-top.png' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background-color: #f0f2f5; }
        .sidebar { background: #fff; min-height: 100vh; }
        .stat-card { transition: transform 0.2s; }
        .stat-card:hover { transform: translateY(-5px); }
        .table-responsive { background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
    </style>
</head>
<body>

    <!-- Navbar Superior -->
    <nav class="navbar navbar-dark bg-dark shadow-sm">
        <div class="container-fluid px-4">
            <a class="navbar-brand fw-bold" href="#">
                <i class="fas fa-chart-line text-success"></i> Panel de Dueño
            </a>
            <div class="d-flex align-items-center gap-3">
                <a href="{% url 'index' %}" class="btn btn-outline-light btn-sm">Ir al Sitio Web</a>
                <span class="text-white small">Hola, {{ user.username }}</span>
            </div>
        </div>
    </nav>

    <div class="container-fluid py-4 px-4">
        <div class="row">
            
            <!-- BARRA LATERAL (Resumen) -->
            <div class="col-md-3 mb-4">
                <div class="card border-0 shadow-sm mb-3">
                    <div class="card-body">
                        <h5 class="text-muted small fw-bold">MIS CANCHAS</h5>
                        <ul class="list-group list-group-flush">
                            {% for c in canchas %}
                                <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                                    {{ c.nombre }}
                                    <span class="badge bg-success rounded-pill">${{ c.precio_hora }}</span>
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>

                <div class="card border-0 shadow-sm bg-success text-white stat-card">
                    <div class="card-body text-center">
                        <h6 class="text-uppercase opacity-75">Ganancias del Día</h6>
                        <h2 class="display-6 fw-bold">${{ ganancia_total }}</h2>
                        <small>{{ fecha_actual }}</small>
                    </div>
                </div>
            </div>

            <!-- CONTENIDO PRINCIPAL (Tabla) -->
            <div class="col-md-9">
                
                <!-- Filtro de Fecha -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h3 class="fw-bold text-dark mb-0">Reservas del Día</h3>
                    <form method="GET" class="d-flex gap-2">
                        <input type="date" name="fecha" class="form-control" value="{{ fecha_actual }}" onchange="this.form.submit()">
                    </form>
                </div>

                {% if reservas %}
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead class="table-light">
                                <tr>
                                    <th>Hora</th>
                                    <th>Cancha</th>
                                    <th>Cliente</th>
                                    <th>Contacto</th>
                                    <th>Estado Pago</th>
                                    <th>Código</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for r in reservas %}
                                <tr class="{% if not r.pagado %}table-warning{% endif %}">
                                    <td class="fw-bold fs-5">{{ r.hora_inicio|time:"H:i" }}</td>
                                    <td>{{ r.cancha.nombre }}</td>
                                    <td>
                                        <div class="fw-bold">{{ r.usuario.first_name }} {{ r.usuario.last_name }}</div>
                                        <small class="text-muted">@{{ r.usuario.username }}</small>
                                    </td>
                                    <td>
                                        <a href="mailto:{{ r.usuario.email }}" class="text-decoration-none">
                                            <i class="far fa-envelope"></i> {{ r.usuario.email }}
                                        </a>
                                    </td>
                                    <td>
                                        {% if r.pagado %}
                                            <span class="badge bg-success"><i class="fas fa-check-circle"></i> PAGADO</span>
                                        {% else %}
                                            <span class="badge bg-warning text-dark"><i class="fas fa-clock"></i> PENDIENTE</span>
                                        {% endif %}
                                    </td>
                                    <td><small class="font-monospace text-muted">{{ r.codigo_reserva|slice:":8" }}</small></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="alert alert-secondary text-center py-5">
                        <i class="far fa-calendar-times fa-3x mb-3 text-muted"></i>
                        <h4>No hay reservas para este día</h4>
                        <p>Intenta cambiar la fecha en el filtro superior.</p>
                    </div>
                {% endif %}

            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>